<!-- Latest compiled and minified CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Latest compiled JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<div class="container mt-3">
  <div class="card", style="width:100%">
    <div class="card bg-dark text-white">
      <div class="card-body">
        <h4 class="card-title" style="margin-left: 1%; margin-top:1%; margin-right: 1%; margin-bottom:1px">{{ post.subject }}</h4>
        <div class="card-text" style="margin-left: 1%; margin-right: 1%; margin-top:1px; white-space: pre-line;">
            {{post.description}}
        </div>
        <div class="card-footer", style="text-align:right; font-size:0.8em">
            {{ post.register_date }}
        </div>
      </div>
    </div>
  </div>
  <div class="border border-5">
    <div class="row">
            <div class="col">
                <div style="margin-left:10px">
                <h5 class="border-bottom my-3 py-2">
                    {{post.comment_set.count}}개의 답변이 있습니다.
                </h5>
                    {{ post.content|safe }}
                </div>
            </div>
            <div class="col">
                <div style="margin-right:10px">
                    <ul class="nav nav-tabs border-bottom my-3">
                        <li class="nav-item">
                            <a class="nav-link active" data-bs-toggle="tab" id="get">user1</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" id="qwer">user2</a>
                        </li>
                        <script>
                            // 사용자 제어권을 EventListener에 의해서 얻을 수 있다.
                            document.querySelector('#get').addEventListener(
                                'click', // browser로 할 수 있는 행위
                                () => {
                                    const data = axios({
                                        //내부에서 접근하는 것이기 때문에 상대경로
                                        url: '/post/comment/get/',
                                        method: 'get', // 기본 method는 get이다
                                        params: {
                                            username: "user",
                                        }
                                    }); // 통신
                                    data.then(function(result){
                                        console.log(result.data);
                                        let html = '<div class="tab-content">';
                                        let content = result.data[0]['content'];
                                        console.log(content);
                                        html += '<div class="tab-pane container active">';
                                        html += `<p>${content}</p>`;
                                        html += '</div></div>';
                                        document.getElementById('menu').innerHTML = html;
                                    }); // 비동기 작업 후 처리하는 CallBack함수   
                                } // Arrow 함수
                            );
                        </script>
                        {% comment %} {% for comment in post.comment_set.all %}
                            {% if forloop.first %}
                                <li class="nav-item">
                                    <a class="nav-link active" data-bs-toggle="tab">
                                        <button href="#{{comment.author}}">{{comment.author}}</button>
                                    </a>
                                </li>

                            {% else %}
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab">
                                        <button href="#{{comment.author}}">{{comment.author}}</button>
                                    </a>
                                </li>
                            {% endif %}
                        {% endfor %} {% endcomment %}
                    </ul>

                    
                    
                    <div class="tab-content" id='menu'>
                        {% comment %} <div class="tab-pane container active" id="home">
                            <br>
                            <p>이런 울니ㅜㅇ리</p>
                        </div> {% endcomment %}
                        {% comment %} <div class="tab-pane container fade" id="menu">
                            <br>
                            <p>ㄷ래ㅜ재두래</p>
                        </div> {% endcomment %}

                        {% comment %} {% for comment in post.comment_set.all %}
                            
                            {% if forloop.first %}
                                <div class="tab-pane container" id="{{forloop.counter0}}"><br>
                                    <p>{{comment.content}}</p>
                                </div>
                            {% else %}
                                
                            {% endif%} 
                        {% endfor %} {% endcomment %}
                    </div>
                </div>
            </div>
        </div>
    </div>



  <form action="{% url 'postapp:comment_create' post.id %}" method="post" class="my-3">
    {% csrf_token %}
    <!-- 오류표시 Start -->
    {% if form.errors %}
    <div class="alert alert-danger" role="alert">
      {% for field in form %}
        {% if field.errors %}
          <strong>{{ field.label }}</strong>
          {{ field.errors }}
        {% endif %}
      {% endfor %}
    </div>
    {% endif %}
    <!-- 오류표시 End -->

    <div class="form-group">
      <textarea name="content" id="content" class="form-control" rows="5"></textarea>
    </div>
    <input type="submit" value="답변등록" class="btn btn-primary">
  </form>
</div>



                            {% comment %} <script>
                                // 사용자 제어권을 EventListener에 의해서 얻을 수 있다.
                                document.querySelector('#{{comment.author}}').addEventListener(
                                    'click', // browser로 할 수 있는 행위
                                    () => {
                                        const data = axios({
                                            //내부에서 접근하는 것이기 때문에 상대경로
                                            url: 'comment/get/',
                                            method: 'get', // 기본 method는 get이다
                                            params: { }
                                        }); // 통신
                                        data.then(function(result){
                                            console.log(result.data);
                                        }); // 비동기 작업 후 처리하는 CallBack함수   
                                    } // Arrow 함수
                                );
                            </script> {% endcomment %}